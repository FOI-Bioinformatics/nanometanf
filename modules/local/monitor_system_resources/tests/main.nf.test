nextflow_process {

    name "Test MONITOR_SYSTEM_RESOURCES"
    script "../main.nf"
    process "MONITOR_SYSTEM_RESOURCES"

    tag "modules"
    tag "modules_local"
    tag "monitor_system_resources"

    test("Should monitor basic system resources") {

        tag "system_monitoring"
        tag "snapshot"

        when {
            process {
                """
                input[0] = [
                    monitoring_interval: 30,
                    collect_cpu_stats: true,
                    collect_memory_stats: true,
                    collect_disk_stats: true
                ]
                """
            }
        }

        then {
            assertAll(
                { assert process.success },
                { assert snapshot(process.out).match() }
            )
        }
    }

    test("Should monitor with GPU detection") {

        tag "gpu_detection"
        tag "snapshot"

        when {
            process {
                """
                input[0] = [
                    monitoring_interval: 10,
                    collect_gpu_stats: true,
                    collect_cpu_stats: true,
                    collect_memory_stats: true
                ]
                """
            }
        }

        then {
            assertAll(
                { assert process.success },
                { assert snapshot(process.out).match() }
            )
        }
    }

    test("Should monitor with network stats") {

        tag "network_stats"
        tag "snapshot"

        when {
            process {
                """
                input[0] = [
                    monitoring_interval: 15,
                    collect_cpu_stats: true,
                    collect_memory_stats: true,
                    collect_network_stats: true
                ]
                """
            }
        }

        then {
            assertAll(
                { assert process.success },
                { assert snapshot(process.out).match() }
            )
        }
    }
}