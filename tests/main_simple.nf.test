nextflow_pipeline {

    name "Test simplified nanometanf pipeline"
    script "../main_simple.nf"

    test("Should run without failures") {

        when {
            params {
                outdir = "$outputDir"
            }
        }

        then {
            assert workflow.success
            assert snapshot(file("${outputDir}/pipeline_info/software_versions.yml")).match("software_versions")
            assert workflow.trace.tasks().size() > 0

            // Check that FASTP ran
            assert workflow.trace.tasks().any { it.name.contains('CHOPPER') || it.name.contains('FASTP') || it.name.contains('FILTLONG') }

            // Check that MultiQC ran
            assert workflow.trace.tasks().any { it.name.contains('MULTIQC') }
        }
    }
}